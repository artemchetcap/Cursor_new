# –≠—Ç–∞–ø 3. Telegram Bot Interface & Admin Tools

## Objective
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞ (aiogram 3), –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —è–¥—Ä—É ETL/LLM –∏ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## Status: ‚úÖ COMPLETED

## Implemented Steps
1. ‚úÖ **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞**
   - –°–æ–∑–¥–∞–Ω `app/bot/main.py` —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π `Bot`, `Dispatcher`.
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `MemoryStorage` –¥–ª—è MVP (—Å–º. AICODE-NOTE –≤ –∫–æ–¥–µ).
2. ‚úÖ **Middleware –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
   - `app/bot/middlewares/user_sync.py` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç `User` —á–µ—Ä–µ–∑ `update_or_create`.
3. ‚úÖ **User Handlers**
   - `app/bot/handlers/start.py` ‚Äî `/start` –∏ `/help` —Å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–æ–º.
   - `app/bot/handlers/message.py`:
     - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, —Ä–µ–∞–∫—Ü–∏—è üëÄ, typing action.
     - –í—ã–∑–æ–≤ –ø–∞—Ä—Å–µ—Ä–æ–≤ –∏ LLM, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Summary Card.
     - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `SummaryRequest` —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏ (processing/success/error).
     - Footer `‚ö°Ô∏è Fast read with @BotName`.
     - –î—Ä—É–∂–µ–ª—é–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö.
4. ‚úÖ **Admin Handlers**
   - `app/bot/handlers/admin.py` ‚Äî `/stats` —Ç–æ–ª—å–∫–æ –¥–ª—è `ADMIN_IDS`.
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 24—á –∏ 7–¥ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∑–∞–ø—Ä–æ—Å—ã, —Ç–æ–∫–µ–Ω—ã).
   - ‚è≥ `/export` (CSV –≤—ã–≥—Ä—É–∑–∫–∞) ‚Äî –æ—Ç–ª–æ–∂–µ–Ω–æ –Ω–∞ –±—É–¥—É—â–µ–µ.
5. ‚úÖ **–ó–∞–ø—É—Å–∫ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
   - `main.py` ‚Äî —ç–Ω—Ç—Ä–∏–ø–æ–∏–Ω—Ç —Å graceful shutdown.
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã `docs/Tech.md` –∏ `README.md`.

## Created Files
```
dogs/
‚îú‚îÄ‚îÄ main.py                          # Entry point
‚îú‚îÄ‚îÄ app/bot/
‚îÇ   ‚îú‚îÄ‚îÄ main.py                      # Bot + Dispatcher init
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.py                 # /start, /help
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message.py               # Message processing
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin.py                 # /stats
‚îÇ   ‚îî‚îÄ‚îÄ middlewares/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ user_sync.py             # User sync middleware
```

## Risks (Mitigated)
1. ‚úÖ **–î–æ–ª–≥–∏–µ –æ—Ç–≤–µ—Ç—ã LLM** ‚Üí —Å—Ç–∞—Ç—É—Å `processing` + typing action.
2. ‚úÖ **Rate Limits** ‚Üí `ThrottlingMiddleware` (5 –∑–∞–ø—Ä–æ—Å–æ–≤/60 —Å–µ–∫, –∞–¥–º–∏–Ω—ã –∏—Å–∫–ª—é—á–µ–Ω—ã).
3. ‚úÖ **–û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞** ‚Üí –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–µ fallback —Å–æ–æ–±—â–µ–Ω–∏—è.
4. ‚úÖ **–£—Ç–µ—á–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤** ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è structlog –±–µ–∑ sensitive data.

## Rollback Strategy
- –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–Ω—Ç—Ä–∏–ø–æ–∏–Ω—Ç; –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –µ–≥–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—è —è–¥—Ä–æ.
- –ú–∏–≥—Ä–∞—Ü–∏–π –ë–î –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é –∫–æ–¥–∞.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏—á-—Ñ–ª–∞–≥–æ–≤/ENV (`ENABLE_BOT`) –ø–æ–∑–≤–æ–ª–∏—Ç –æ—Ç–∫–ª—é—á–∏—Ç—å Telegram –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É.
